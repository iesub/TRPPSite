{% extends "base.html" %}

{% block content %}
    <div class = 'main-part'>
    <h1>Привет, {{ current_user.username }}!</h1>
    <h2>Ваши чаты:</h2>
    <form action="" method="post" novalidate>
        {{ form.hidden_tag() }}
            {{ form.create_name.label }}<br>
            {{ form.create_name(size=64) }}
            {% for error in form.create_name.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
            {{ form.create_submit() }}<br>
            {{ form.search_name.label }}<br>
            {{ form.search_name(size=64) }}
            {% for error in form.search_name.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
            {{ form.search_submit() }}
    </form>
    <div class = 'friends-messages'>
        {% for chat in chats %}
            <div class = "chat-instance" onclick = "location.href = '{{ url_for('chat', chat_id=chat.id) }}';">
					<div class = "chat-image">
						<img src = "../static/empty.jpg">
					</div>
					<div class = "chat-inf">
						<div class = "chat-name">
                            {% if chat.name.find('none') == -1 %}
                                <h4>{{ chat.name }}</h4>
                            {% elif chat.users[0] == current_user %}
                                <h4>{{chat.users[1].username }}</h4>
                            {% else %}
                                <h4>{{chat.users[0].username }}</h4>
                            {% endif %}
						</div>
						<div class = "chat-last-message">
							<p> {{ chat.posts[-1].body }}</p>
                            <p> {{ chat.posts[-1].timestamp }}</p>
						</div>
					</div>
				</div>
                {% endfor %}
        </div>
    </div>
    <div class = "notification-block">
    {% if count > 0 %}
    <p>Вас приглашают в следующие чаты:</p>
        {% for invitation in invitations %}
            <div class = "not-block">
                <p>{{ invitation.chat.name }}</p>
                <p><a href="{{ url_for('accept_the_invitation', invitation_id=invitation.id) }}">Принять приглашение</a></p>
                <p><a href="{{ url_for('decline_the_invitation', invitation_id=invitation.id) }}">Отклонить приглашение</a></p>
            </div>
        {% endfor %}
    {% endif %}

    </div>
{% endblock %}